---
import Layout from '../../../layouts/Layout.astro';
import { marked } from 'marked';

const sections = [
  {
    title: 'Prerequisites',
    content: `
      Before you begin, make sure you have:
      
      - Node.js v16.9.0 or higher installed
      - A code editor (VS Code recommended)
      - Basic JavaScript knowledge
      - A Discord account
    `
  },
  {
    title: 'Creating a Discord Application',
    content: `
      1. Go to the [Discord Developer Portal](https://discord.com/developers/applications)
      2. Click "New Application"
      3. Give your application a name
      4. Navigate to the "Bot" section
      5. Click "Add Bot"
      6. Copy your bot token (keep it secure!)
    `
  },
  {
    title: 'Setting Up Your Project',
    content: `
      Create a new Node.js project:

      \`\`\`bash
      mkdir my-discord-bot
      cd my-discord-bot
      npm init -y
      npm install discord.js
      \`\`\`

      Create your main bot file (index.js):

      \`\`\`javascript
      const { Client, GatewayIntentBits } = require('discord.js');

      const client = new Client({
        intents: [
          GatewayIntentBits.Guilds,
          GatewayIntentBits.GuildMessages,
          GatewayIntentBits.MessageContent
        ]
      });

      client.once('ready', () => {
        console.log(\`Logged in as \${client.user.tag}\`);
      });

      client.on('messageCreate', message => {
        if (message.content === '!ping') {
          message.reply('Pong!');
        }
      });

      client.login('your-token-here');
      \`\`\`
    `
  },
  {
    title: 'Running Your Bot',
    content: `
      1. Save your bot token in a .env file:
      
      \`\`\`bash
      TOKEN=your-token-here
      \`\`\`

      2. Run your bot:

      \`\`\`bash
      node index.js
      \`\`\`

      Your bot should now be online and responding to the !ping command!
    `
  }
];
---

<Layout title="Getting Started with Discord.js">
  <div class="max-w-4xl mx-auto py-8">
    <h1 class="text-4xl font-bold mb-8">Getting Started with Discord.js</h1>
    
    <div class="space-y-12">
      {sections.map((section, index) => (
        <div class="bg-[#2B2D31] p-6 rounded-lg">
          <h2 class="text-2xl font-semibold mb-4">
            <span class="text-[#5865F2] mr-2">{index + 1}.</span>
            {section.title}
          </h2>
          <!-- Markdown içeriğini HTML olarak render ediyoruz -->
          <div class="prose prose-invert max-w-none section-content" set:html={marked(section.content)}>
          </div>
        </div>
      ))}
    </div>

    <div class="mt-8 flex justify-between">
      <a 
        href="/getting-started" 
        class="bg-[#4F545C] hover:bg-[#686D73] px-6 py-3 rounded-md font-medium transition-colors"
      >
        ← Back to Overview
      </a>
      <a 
        href="/docs/discord-js/commands" 
        class="bg-[#5865F2] hover:bg-[#4752C4] px-6 py-3 rounded-md font-medium transition-colors"
      >
        Next: Creating Commands →
      </a>
    </div>
  </div>

  <!-- Kod kutusu stil ve kopyalama butonu için özel CSS -->
  <style>
    .code-container {
      position: relative;
      background-color: #2B2D31;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      overflow: auto;
    }
    .code-container pre {
      background: transparent;
      margin: 0;
      font-family: monospace;
      font-size: 0.875rem;
      color: #f8f8f2;
    }
    .copy-button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: #5865F2;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .code-container:hover .copy-button {
      opacity: 1;
    }
  </style>

  <!-- Tüm kod bloklarına kopyalama fonksiyonu ekleyen script -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // .section-content içindeki tüm <pre> elementlerini buluyoruz
      const codeBlocks = document.querySelectorAll('.section-content pre');
      codeBlocks.forEach((block) => {
        // Zaten wrap edilmemişse container oluşturuyoruz
        if (!block.parentElement.classList.contains('code-container')) {
          const container = document.createElement('div');
          container.className = 'code-container';
          block.parentNode.insertBefore(container, block);
          container.appendChild(block);

          // Kopyalama butonunu oluşturuyoruz
          const button = document.createElement('button');
          button.className = 'copy-button';
          button.textContent = 'Copy';
          container.appendChild(button);

          // Butona tıklanınca kodu kopyalama işlemi
          button.addEventListener('click', () => {
            const codeText = block.innerText.trim();
            navigator.clipboard.writeText(codeText).then(() => {
              button.textContent = 'Copied!';
              setTimeout(() => {
                button.textContent = 'Copy';
              }, 2000);
            });
          });
        }
      });
    });
  </script>
</Layout>
